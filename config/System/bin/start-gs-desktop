#!/bin/bash

export WMAKER_USER_ROOT=$HOME/Library/WindowMaker
export PATH=/System/bin:$PATH
export RUNTIME_VERSION="gnustep-2.0"
export GS_DESKTOP_LOG=/tmp/$UID-gs-desktop.log

source /Developer/Makefiles/GNUstep.sh

echo "starting GS Desktop"             > "$GS_DESKTOP_LOG"

if [ ! -f "$HOME/Library/Preferences/NSGlobalDomain.plist" ];then
  mkdir "$HOME/Library/Preferences" 2>/dev/null
  cp /Library/Preferences/* "$HOME/Library/Preferences/"
fi

(/System/bin/wmaker >> "$GS_DESKTOP_LOG" 2>&1) &
WM_PID=$!
echo "WM is running on $WM_PID"       >> "$GS_DESKTOP_LOG"
echo "$WM_PID" > /tmp/$UID-wm.pid
wait "$WM_PID"

echo "finishing GS Desktop"           >> "$GS_DESKTOP_LOG"
