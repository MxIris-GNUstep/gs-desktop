#!/Library/bin/stexec

[|
  main
    Environment loadModule:'AppKit'.

    self implementProtocol:'NSBrowserDelegate'.
    self implementProtocol:'NSApplicationDelegate'.

    app := NSApplication sharedApplication.
    app setDelegate:self.
    app run.

    ^self
  !

  application:app openFile:file
    ^nil
  !

  browser:b numberOfRowsInColumn:col
    ^5
  !

  browser:b willDisplayCell:cell atRow:row column:col
    cell setLeaf:YES.
    cell setStringValue:'a'.
    ^nil
  !

  selectRow
    sel := browser selectedCell stringValue.
    Transcript showLine:sel.
    app terminate:self.
  !

  applicationDidFinishLaunching:not
    Shell readLines:'/dev/stdin'.

    frame := (10 @ 10) extent: (180 @@ 160).
    browser := NSBrowser alloc initWithFrame:frame.
    browser setDelegate:self.
    browser setDoubleAction:#selectRow.

    frame := (10 @ 10) extent: (200 @@ 200).
    panel := NSPanel alloc init.
    panel contentView addSubview:browser.
    panel setFrame:frame display:YES.

    app runModalForWindow: panel.
    app terminate:nil.

    ^nil
]
